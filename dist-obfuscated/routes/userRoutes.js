'use strict';const a12_0xb720b3=a12_0x2f03;(function(_0x349a6a,_0x75bd5d){const _0x11c341=a12_0x2f03,_0x101c10=_0x349a6a();while(!![]){try{const _0x3166bc=-parseInt(_0x11c341(0x1d5))/0x1*(-parseInt(_0x11c341(0x19f))/0x2)+-parseInt(_0x11c341(0x1c8))/0x3+-parseInt(_0x11c341(0x1a4))/0x4+-parseInt(_0x11c341(0x175))/0x5*(-parseInt(_0x11c341(0x19b))/0x6)+parseInt(_0x11c341(0x185))/0x7*(-parseInt(_0x11c341(0x1cb))/0x8)+parseInt(_0x11c341(0x1ad))/0x9+parseInt(_0x11c341(0x1c3))/0xa*(parseInt(_0x11c341(0x1ce))/0xb);if(_0x3166bc===_0x75bd5d)break;else _0x101c10['push'](_0x101c10['shift']());}catch(_0x4834cb){_0x101c10['push'](_0x101c10['shift']());}}}(a12_0x5b3f,0xa9514));function a12_0x5b3f(){const _0x78f2b6=['Router','delete','User','RESET\x20PASSWORD','82200CgXSSf','User\x20profile\x20retrieved\x20successfully','Forgot\x20Password\x20Error:','-password\x20-resetKey','_id','2422683LQHKiy','sign','toString','8HMlsPS','deleteMany','findById','1958xjANgM','done','ResponseHandler','hex','get','verify','password','2BBlfsE','post','Delete\x20displays\x20related','554415oWejpr','sendMail','select','.\x20It\x20is\x20valid\x20for\x2010\x20minutes.','Invalid\x20email\x20or\x20password','userId','password\x20reset\x20success!','unauthorized','body','We8Z','__esModule','reset!','express','Account\x20deleted\x20successfully','Internal\x20server\x20error:\x20','findByIdAndUpdate','6118735KEzuGD','Login\x20successful','jsonwebtoken','next','warn','../models/User','compare','Invalid\x20token\x20signature','gmail','noreply@things-connect.net','Edit\x20Profile\x20Error:','failure:\x20','Token\x20refreshed\x20successfully','decode','/forgot-password','Refresh\x20Token\x20Error:','crypto','JWT_SECRET','User\x20not\x20found','At\x20least\x20one\x20field\x20is\x20required\x20to\x20update\x20the\x20profile','resetKey','error','36nengCn','__importDefault','hash','default','577652kbAdJz','internalServerError','notFound','save','findOne','5093956WwIhms','Delete\x20Account\x20Error:','email','toUpperCase','success','Get\x20Profile\x20Error:','regal_top_secret','Display','../handlers/error_handler','8483121NXJiYw','env','User\x20registered\x20successfully','User\x20with\x20this\x20email\x20does\x20not\x20exist','value','Missing\x20required\x20fields','User\x20already\x20exists','createTransport','randomBytes','NO_REPLY_MAIL','/account','Token\x20signature\x20is\x20invalid:','NO_REPLY_MAIL_PASS','defineProperty','findByIdAndDelete','log','regal_refresh_secret_999','Refresh\x20token\x20is\x20required'];a12_0x5b3f=function(){return _0x78f2b6;};return a12_0x5b3f();}var __awaiter=this&&this['__awaiter']||function(_0xd028b3,_0x1c9465,_0x3313d4,_0x5965b4){function _0x2401af(_0x336fcb){return _0x336fcb instanceof _0x3313d4?_0x336fcb:new _0x3313d4(function(_0x539271){_0x539271(_0x336fcb);});}return new(_0x3313d4||(_0x3313d4=Promise))(function(_0x18bda6,_0x13301d){const _0x41543b=a12_0x2f03;function _0x233755(_0x515d6d){const _0x5a8b3a=a12_0x2f03;try{_0xac4393(_0x5965b4[_0x5a8b3a(0x188)](_0x515d6d));}catch(_0x35aeb4){_0x13301d(_0x35aeb4);}}function _0x273f90(_0x348619){try{_0xac4393(_0x5965b4['throw'](_0x348619));}catch(_0x9ceca0){_0x13301d(_0x9ceca0);}}function _0xac4393(_0x2f2d52){const _0x32a6c3=a12_0x2f03;_0x2f2d52[_0x32a6c3(0x1cf)]?_0x18bda6(_0x2f2d52[_0x32a6c3(0x1b1)]):_0x2401af(_0x2f2d52['value'])['then'](_0x233755,_0x273f90);}_0xac4393((_0x5965b4=_0x5965b4['apply'](_0xd028b3,_0x1c9465||[]))[_0x41543b(0x188)]());});},__importDefault=this&&this[a12_0xb720b3(0x19c)]||function(_0xe69bd3){const _0x4304b5=a12_0xb720b3;return _0xe69bd3&&_0xe69bd3[_0x4304b5(0x17f)]?_0xe69bd3:{'default':_0xe69bd3};};function a12_0x2f03(_0x1b33ed,_0x36be91){const _0x5b3f42=a12_0x5b3f();return a12_0x2f03=function(_0x2f037b,_0x407959){_0x2f037b=_0x2f037b-0x173;let _0x306146=_0x5b3f42[_0x2f037b];return _0x306146;},a12_0x2f03(_0x1b33ed,_0x36be91);}Object[a12_0xb720b3(0x1ba)](exports,a12_0xb720b3(0x17f),{'value':!![]});const express_1=__importDefault(require(a12_0xb720b3(0x181))),bcrypt_1=__importDefault(require('bcrypt')),jsonwebtoken_1=__importDefault(require(a12_0xb720b3(0x187))),nodemailer_1=__importDefault(require('nodemailer')),crypto_1=__importDefault(require(a12_0xb720b3(0x195))),User_1=require(a12_0xb720b3(0x18a)),authorise_1=__importDefault(require('../middlewares/authorise')),Display_1=require('../models/Display'),error_handler_1=require(a12_0xb720b3(0x1ac)),router=express_1[a12_0xb720b3(0x19e)][a12_0xb720b3(0x1bf)]();router[a12_0xb720b3(0x173)]('/register',(_0x431dc3,_0x2249d6)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x495849=a12_0xb720b3;try{const {firstName:_0x2f116f,lastName:_0x1c428f,email:_0x2a42d0,password:_0x59610a,phone:_0x5b8aed,age:_0x52fb1d,address:_0x2ccd97}=_0x431dc3[_0x495849(0x17d)];if(!_0x2f116f||!_0x1c428f||!_0x2a42d0||!_0x59610a){error_handler_1[_0x495849(0x1d0)][_0x495849(0x19a)](_0x2249d6,_0x495849(0x1b2),0x195);return;}const _0x44c94e=yield User_1[_0x495849(0x1c1)][_0x495849(0x1a3)]({'email':_0x2a42d0});if(_0x44c94e){error_handler_1[_0x495849(0x1d0)][_0x495849(0x19a)](_0x2249d6,_0x495849(0x1b3),0x195);return;}const _0x36b8aa=0xa,_0x230783=yield bcrypt_1[_0x495849(0x19e)][_0x495849(0x19d)](_0x59610a,_0x36b8aa),_0x869d43=new User_1[(_0x495849(0x1c1))]({'firstName':_0x2f116f,'lastName':_0x1c428f,'email':_0x2a42d0,'password':_0x230783,'phone':_0x5b8aed,'age':_0x52fb1d,'address':_0x2ccd97});yield _0x869d43[_0x495849(0x1a2)](),error_handler_1[_0x495849(0x1d0)][_0x495849(0x1a8)](_0x2249d6,_0x869d43,_0x495849(0x1af));}catch(_0x203165){error_handler_1[_0x495849(0x1d0)][_0x495849(0x1a0)](_0x2249d6,'Internal\x20server\x20error:\x20'+_0x203165);}})),router[a12_0xb720b3(0x173)]('/login',(_0x21b049,_0x18f05a)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x32a1ac=a12_0xb720b3;try{const {email:_0x54e6e1,password:_0x4dbacb}=_0x21b049['body'],_0x2a5bcc=yield User_1[_0x32a1ac(0x1c1)][_0x32a1ac(0x1a3)]({'email':_0x54e6e1});if(!_0x2a5bcc){error_handler_1[_0x32a1ac(0x1d0)]['notFound'](_0x18f05a,_0x32a1ac(0x179));return;}const _0x38e670=yield bcrypt_1[_0x32a1ac(0x19e)][_0x32a1ac(0x18b)](_0x4dbacb,_0x2a5bcc[_0x32a1ac(0x1d4)]);if(!_0x38e670){error_handler_1[_0x32a1ac(0x1d0)][_0x32a1ac(0x17c)](_0x18f05a,_0x32a1ac(0x179));return;}const _0x56f3f8=jsonwebtoken_1[_0x32a1ac(0x19e)][_0x32a1ac(0x1c9)]({'_id':_0x2a5bcc['_id'],'email':_0x2a5bcc[_0x32a1ac(0x1a6)]},process[_0x32a1ac(0x1ae)][_0x32a1ac(0x196)]||_0x32a1ac(0x1aa),{'expiresIn':'5h'}),_0x1cd169=jsonwebtoken_1[_0x32a1ac(0x19e)][_0x32a1ac(0x1c9)]({'_id':_0x2a5bcc[_0x32a1ac(0x1c7)],'email':_0x2a5bcc[_0x32a1ac(0x1a6)]},process[_0x32a1ac(0x1ae)]['REFRESH_SECRET']||_0x32a1ac(0x1bd),{'expiresIn':'20d'}),_0x128dd5={'user':_0x2a5bcc,'token':_0x56f3f8,'refreshToken':_0x1cd169};error_handler_1[_0x32a1ac(0x1d0)][_0x32a1ac(0x1a8)](_0x18f05a,_0x128dd5,_0x32a1ac(0x186));}catch(_0x3e3732){error_handler_1[_0x32a1ac(0x1d0)][_0x32a1ac(0x1a0)](_0x18f05a,_0x32a1ac(0x183)+_0x3e3732);}})),router[a12_0xb720b3(0x173)](a12_0xb720b3(0x193),(_0x1b38c8,_0x1c0207)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0xc1f70e=a12_0xb720b3;try{const {email:_0x49efe8}=_0x1b38c8[_0xc1f70e(0x17d)],_0x15a6c6=yield User_1[_0xc1f70e(0x1c1)][_0xc1f70e(0x1a3)]({'email':_0x49efe8});if(!_0x15a6c6){error_handler_1[_0xc1f70e(0x1d0)][_0xc1f70e(0x1a1)](_0x1c0207,_0xc1f70e(0x1b0));return;}const _0x364943=crypto_1[_0xc1f70e(0x19e)][_0xc1f70e(0x1b5)](0x4)[_0xc1f70e(0x1ca)](_0xc1f70e(0x1d1))[_0xc1f70e(0x1a7)]();_0x15a6c6[_0xc1f70e(0x199)]=_0x364943,yield _0x15a6c6[_0xc1f70e(0x1a2)]();const _0x5f4704=nodemailer_1[_0xc1f70e(0x19e)][_0xc1f70e(0x1b4)]({'service':_0xc1f70e(0x18d),'auth':{'user':process['env'][_0xc1f70e(0x1b6)],'pass':process[_0xc1f70e(0x1ae)][_0xc1f70e(0x1b9)]}}),_0x333fb1={'from':_0xc1f70e(0x18e),'to':_0x49efe8,'subject':_0xc1f70e(0x1c2),'text':'Your\x20password\x20reset\x20key\x20is:\x20'+_0x364943+_0xc1f70e(0x178)};_0x5f4704[_0xc1f70e(0x176)](_0x333fb1,function(_0x531a79,_0x1aef77){const _0x3fc9a8=_0xc1f70e;if(_0x531a79)console[_0x3fc9a8(0x1bc)](_0x531a79),error_handler_1[_0x3fc9a8(0x1d0)][_0x3fc9a8(0x19a)](_0x1c0207,_0x3fc9a8(0x190)+_0x531a79,0x194);else{error_handler_1[_0x3fc9a8(0x1d0)][_0x3fc9a8(0x1a8)](_0x1c0207,'',_0x3fc9a8(0x17b));let _0x21b646=0x927c0;new Promise(function(_0xeefe17,_0xe57b46){setTimeout(()=>{const _0x267504=a12_0x2f03;console[_0x267504(0x1bc)](_0x267504(0x180)),_0x15a6c6[_0x267504(0x199)]=_0x267504(0x17e),_0x15a6c6[_0x267504(0x1a2)]();},_0x21b646);});}});}catch(_0xecdbe2){console[_0xc1f70e(0x19a)](_0xc1f70e(0x1c5),_0xecdbe2),error_handler_1[_0xc1f70e(0x1d0)][_0xc1f70e(0x1a0)](_0x1c0207,_0xc1f70e(0x183)+_0xecdbe2);}})),router[a12_0xb720b3(0x1d2)](a12_0xb720b3(0x1b7),authorise_1[a12_0xb720b3(0x19e)],(_0x5ef131,_0x494680)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x477c63=a12_0xb720b3;try{const _0x32b44d=_0x5ef131['userId'],_0x4f49b0=yield User_1['User'][_0x477c63(0x1cd)](_0x32b44d)[_0x477c63(0x177)](_0x477c63(0x1c6));if(!_0x4f49b0){error_handler_1[_0x477c63(0x1d0)][_0x477c63(0x1a1)](_0x494680,_0x477c63(0x197));return;}error_handler_1[_0x477c63(0x1d0)][_0x477c63(0x1a8)](_0x494680,_0x4f49b0,_0x477c63(0x1c4));}catch(_0x55b82f){console[_0x477c63(0x19a)](_0x477c63(0x1a9),_0x55b82f),error_handler_1['ResponseHandler'][_0x477c63(0x1a0)](_0x494680,_0x477c63(0x183)+_0x55b82f);}})),router['put']('/account',authorise_1['default'],(_0x3637a7,_0xa27bfb)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x193519=a12_0xb720b3;try{const _0x299c45=_0x3637a7[_0x193519(0x17a)],{firstName:_0x15e925,lastName:_0x408e85,phone:_0x41d004,age:_0x1fa942,address:_0x3e71f4}=_0x3637a7[_0x193519(0x17d)];if(!_0x15e925&&!_0x408e85&&!_0x41d004&&!_0x1fa942&&!_0x3e71f4){error_handler_1[_0x193519(0x1d0)][_0x193519(0x19a)](_0xa27bfb,_0x193519(0x198),0x190);return;}const _0x1440e1=yield User_1[_0x193519(0x1c1)][_0x193519(0x184)](_0x299c45,{'$set':{'firstName':_0x15e925,'lastName':_0x408e85,'phone':_0x41d004,'age':_0x1fa942,'address':_0x3e71f4}},{'new':!![],'runValidators':!![]})[_0x193519(0x177)](_0x193519(0x1c6));if(!_0x1440e1){error_handler_1[_0x193519(0x1d0)][_0x193519(0x1a1)](_0xa27bfb,_0x193519(0x197));return;}error_handler_1[_0x193519(0x1d0)][_0x193519(0x1a8)](_0xa27bfb,_0x1440e1,'User\x20profile\x20updated\x20successfully');}catch(_0x51553c){console[_0x193519(0x19a)](_0x193519(0x18f),_0x51553c),error_handler_1[_0x193519(0x1d0)]['internalServerError'](_0xa27bfb,_0x193519(0x183)+_0x51553c);}})),router[a12_0xb720b3(0x1c0)](a12_0xb720b3(0x1b7),authorise_1[a12_0xb720b3(0x19e)],(_0xa50e96,_0xd81f69)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x489b15=a12_0xb720b3;try{const _0x440182=_0xa50e96[_0x489b15(0x17a)],_0x5006aa=yield User_1[_0x489b15(0x1c1)][_0x489b15(0x1bb)](_0x440182);if(!_0x5006aa){error_handler_1[_0x489b15(0x1d0)][_0x489b15(0x1a1)](_0xd81f69,'User\x20not\x20found');return;}console[_0x489b15(0x19a)](_0x489b15(0x174)),yield Display_1[_0x489b15(0x1ab)][_0x489b15(0x1cc)]({'ownerId':_0x440182}),error_handler_1['ResponseHandler'][_0x489b15(0x1a8)](_0xd81f69,_0x5006aa,_0x489b15(0x182));}catch(_0x20a153){console[_0x489b15(0x19a)](_0x489b15(0x1a5),_0x20a153),error_handler_1[_0x489b15(0x1d0)][_0x489b15(0x1a0)](_0xd81f69,_0x489b15(0x183)+_0x20a153);}})),router['post']('/refresh-token',(_0x1a10a2,_0x3ee6b8)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3b5f18=a12_0xb720b3;try{const {token:_0x4a8f87}=_0x1a10a2[_0x3b5f18(0x17d)];if(!_0x4a8f87){error_handler_1[_0x3b5f18(0x1d0)][_0x3b5f18(0x19a)](_0x3ee6b8,_0x3b5f18(0x1be),0x190);return;}const _0xc98986=process[_0x3b5f18(0x1ae)][_0x3b5f18(0x196)]||'regal_top_secret';let _0x503cc1;try{_0x503cc1=jsonwebtoken_1[_0x3b5f18(0x19e)][_0x3b5f18(0x192)](_0x4a8f87);if(!_0x503cc1||!_0x503cc1[_0x3b5f18(0x1c7)]||!_0x503cc1[_0x3b5f18(0x1a6)]){error_handler_1[_0x3b5f18(0x1d0)]['unauthorized'](_0x3ee6b8,'Invalid\x20token\x20payload');return;}}catch(_0x2299ed){console['error']('Token\x20decoding\x20failed:',_0x2299ed),error_handler_1[_0x3b5f18(0x1d0)][_0x3b5f18(0x17c)](_0x3ee6b8,'Invalid\x20token');return;}try{jsonwebtoken_1[_0x3b5f18(0x19e)][_0x3b5f18(0x1d3)](_0x4a8f87,_0xc98986,{'ignoreExpiration':!![]});}catch(_0x4f8dd7){console[_0x3b5f18(0x189)](_0x3b5f18(0x1b8),_0x4f8dd7),error_handler_1[_0x3b5f18(0x1d0)][_0x3b5f18(0x17c)](_0x3ee6b8,_0x3b5f18(0x18c));return;}const _0xf904f4=jsonwebtoken_1[_0x3b5f18(0x19e)][_0x3b5f18(0x1c9)]({'_id':_0x503cc1['_id'],'email':_0x503cc1['email']},_0xc98986,{'expiresIn':'5h'});error_handler_1[_0x3b5f18(0x1d0)][_0x3b5f18(0x1a8)](_0x3ee6b8,{'token':_0xf904f4},_0x3b5f18(0x191));}catch(_0x1f69c9){console['error'](_0x3b5f18(0x194),_0x1f69c9),error_handler_1['ResponseHandler']['internalServerError'](_0x3ee6b8,_0x3b5f18(0x183)+_0x1f69c9);}})),exports['default']=router;