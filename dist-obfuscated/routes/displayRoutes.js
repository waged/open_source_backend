'use strict';const a10_0x535592=a10_0x40e4;(function(_0x5ecedf,_0x1c73ea){const _0x1c8c78=a10_0x40e4,_0x2e74ae=_0x5ecedf();while(!![]){try{const _0x14612c=-parseInt(_0x1c8c78(0x151))/0x1*(-parseInt(_0x1c8c78(0x144))/0x2)+parseInt(_0x1c8c78(0x14d))/0x3+-parseInt(_0x1c8c78(0x149))/0x4*(-parseInt(_0x1c8c78(0x123))/0x5)+parseInt(_0x1c8c78(0xf6))/0x6+parseInt(_0x1c8c78(0xed))/0x7*(-parseInt(_0x1c8c78(0x11b))/0x8)+parseInt(_0x1c8c78(0xf7))/0x9+-parseInt(_0x1c8c78(0x115))/0xa;if(_0x14612c===_0x1c73ea)break;else _0x2e74ae['push'](_0x2e74ae['shift']());}catch(_0x296d76){_0x2e74ae['push'](_0x2e74ae['shift']());}}}(a10_0xe1ae,0x67dfd));var __awaiter=this&&this[a10_0x535592(0x12a)]||function(_0x186939,_0x3ecfa6,_0xc14b7e,_0xc9c01){function _0x26478c(_0x2f7043){return _0x2f7043 instanceof _0xc14b7e?_0x2f7043:new _0xc14b7e(function(_0x437ce2){_0x437ce2(_0x2f7043);});}return new(_0xc14b7e||(_0xc14b7e=Promise))(function(_0x25a9ed,_0x10b23a){const _0x3b0e89=a10_0x40e4;function _0x10b4cb(_0x241041){const _0x3d3027=a10_0x40e4;try{_0x71ea3d(_0xc9c01[_0x3d3027(0x12d)](_0x241041));}catch(_0x2a4aa4){_0x10b23a(_0x2a4aa4);}}function _0x2f0993(_0x47b536){try{_0x71ea3d(_0xc9c01['throw'](_0x47b536));}catch(_0x4ae1e8){_0x10b23a(_0x4ae1e8);}}function _0x71ea3d(_0x3ce759){const _0xf3040d=a10_0x40e4;_0x3ce759[_0xf3040d(0x110)]?_0x25a9ed(_0x3ce759['value']):_0x26478c(_0x3ce759[_0xf3040d(0x118)])['then'](_0x10b4cb,_0x2f0993);}_0x71ea3d((_0xc9c01=_0xc9c01[_0x3b0e89(0x11d)](_0x186939,_0x3ecfa6||[]))[_0x3b0e89(0x12d)]());});},__rest=this&&this['__rest']||function(_0x4f2391,_0x10ab96){const _0x3b7e02=a10_0x535592;var _0x23e188={};for(var _0x4ed974 in _0x4f2391)if(Object[_0x3b7e02(0x13f)][_0x3b7e02(0xf8)]['call'](_0x4f2391,_0x4ed974)&&_0x10ab96[_0x3b7e02(0x137)](_0x4ed974)<0x0)_0x23e188[_0x4ed974]=_0x4f2391[_0x4ed974];if(_0x4f2391!=null&&typeof Object[_0x3b7e02(0xf1)]===_0x3b7e02(0x108))for(var _0x4794b3=0x0,_0x4ed974=Object['getOwnPropertySymbols'](_0x4f2391);_0x4794b3<_0x4ed974[_0x3b7e02(0x119)];_0x4794b3++){if(_0x10ab96[_0x3b7e02(0x137)](_0x4ed974[_0x4794b3])<0x0&&Object[_0x3b7e02(0x13f)]['propertyIsEnumerable'][_0x3b7e02(0x121)](_0x4f2391,_0x4ed974[_0x4794b3]))_0x23e188[_0x4ed974[_0x4794b3]]=_0x4f2391[_0x4ed974[_0x4794b3]];}return _0x23e188;},__importDefault=this&&this[a10_0x535592(0x143)]||function(_0x5d1fe2){const _0xe9cd5b=a10_0x535592;return _0x5d1fe2&&_0x5d1fe2[_0xe9cd5b(0xec)]?_0x5d1fe2:{'default':_0x5d1fe2};};Object[a10_0x535592(0x148)](exports,'__esModule',{'value':!![]});function a10_0xe1ae(){const _0x4d0732=['storage_iframe_player','includes','array','notFound','Error\x20retrieving\x20display:','function','push','../middlewares/authorise','Get\x20Specific\x20Image\x20Error:','://','images','/add','../handlers/error_handler','done','unlink','Display','Image\x20file\x20does\x20not\x20exist\x20on\x20the\x20server','multer','14392890BpdHBj','body','existsSync','value','length','message','144JCSdCh','filename','apply','diskStorage','path','../../..','call','Product\x20retrieved\x20successfully','486665poyCYm','/delete/:id','../models/Display','mkdirSync','/get/qr-auto/:autoQR','/images/:displayId','Router','__awaiter','originalname','userId','next','imageIds','Failed\x20to\x20delete\x20the\x20file:\x20','image-','ownerId','params','join','Missing\x20required\x20fields:\x20','random','Internal\x20server\x20error\x20:\x20','indexOf','A\x20display\x20with\x20the\x20same\x20MAC\x20already\x20exists\x20in\x20this\x20profile','post','Image\x20deleted\x20successfully','get','findOneAndUpdate','Internal\x20server\x20error:\x20','Image\x20not\x20associated\x20with\x20this\x20product','prototype','delete','find','/image/:displayId/:filename','__importDefault','331944YGkSXJ','Get\x20Images\x20Error:','files','No\x20images\x20uploaded','defineProperty','28ngfVDV','No\x20products\x20found\x20for\x20this\x20owner','express','save','1472283yXeDaB','name','Delete\x20Image\x20Error:','filepath:\x20','1MSMDUi','/get/one/:displayId','Display\x20added\x20successfully','__esModule','18193QwhaIO','Add\x20Display\x20Error:','findOne','error','getOwnPropertySymbols','Display\x20not\x20found\x20for\x20the\x20given\x20company','sendFile','filter','now','1770396ylgmgN','2505690KVOmCf','hasOwnProperty','Error\x20retrieving\x20product:','round','unauthorized','default','../../../','ResponseHandler','success','Product\x20not\x20found\x20or\x20unauthorized','internalServerError','extname'];a10_0xe1ae=function(){return _0x4d0732;};return a10_0xe1ae();}function a10_0x40e4(_0x471200,_0x2dbd2f){const _0xe1ae40=a10_0xe1ae();return a10_0x40e4=function(_0x40e48a,_0x143869){_0x40e48a=_0x40e48a-0xec;let _0x4baf44=_0xe1ae40[_0x40e48a];return _0x4baf44;},a10_0x40e4(_0x471200,_0x2dbd2f);}const express_1=__importDefault(require(a10_0x535592(0x14b))),Display_1=require(a10_0x535592(0x125)),authorise_1=__importDefault(require('../middlewares/authorise')),authorise_2=__importDefault(require(a10_0x535592(0x10a))),multer_1=__importDefault(require(a10_0x535592(0x114))),path_1=__importDefault(require(a10_0x535592(0x11f))),fs_1=__importDefault(require('fs')),error_handler_1=require(a10_0x535592(0x10f)),router=express_1[a10_0x535592(0xfc)][a10_0x535592(0x129)](),storageDir=path_1[a10_0x535592(0xfc)][a10_0x535592(0x133)](__dirname,a10_0x535592(0x103));!fs_1[a10_0x535592(0xfc)][a10_0x535592(0x117)](storageDir)&&fs_1['default'][a10_0x535592(0x126)](storageDir,{'recursive':!![]});const storage=multer_1['default'][a10_0x535592(0x11e)]({'destination':(_0x2c789b,_0x48f7d4,_0x4f0385)=>{const _0xfdfd93=a10_0x535592,_0x688c9b=path_1[_0xfdfd93(0xfc)]['join'](__dirname,'../../../storage_iframe_player');fs_1[_0xfdfd93(0xfc)][_0xfdfd93(0x126)](_0x688c9b,{'recursive':!![]}),_0x4f0385(null,_0x688c9b);},'filename':(_0x47f31e,_0x49aa47,_0x532356)=>{const _0x592839=a10_0x535592,_0x1a3878=Date[_0x592839(0xf5)]()+'-'+Math[_0x592839(0xfa)](Math[_0x592839(0x135)]()*0x3b9aca00),_0x1754b6=path_1[_0x592839(0xfc)][_0x592839(0x102)](_0x49aa47[_0x592839(0x12b)]);_0x532356(null,_0x592839(0x130)+_0x1a3878+_0x1754b6);}}),upload=(0x0,multer_1[a10_0x535592(0xfc)])({'storage':storage,'limits':{'fileSize':0x9*0x400*0x400}});router[a10_0x535592(0x139)](a10_0x535592(0x10e),authorise_1[a10_0x535592(0xfc)],(_0x350944,_0x50913a)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x5cc2bb=a10_0x535592;try{const _0x3b51b3=_0x350944[_0x5cc2bb(0x12c)],{name:_0x2345b4,macAddress:_0x468823,isLandscape:_0x11b447,producer:_0x2645ba,category:_0x2e3aa4,dimension:_0x512b4b,description:_0x240618}=_0x350944[_0x5cc2bb(0x116)],_0x323ed9=[];if(!_0x3b51b3)_0x323ed9[_0x5cc2bb(0x109)](_0x5cc2bb(0x131));if(!_0x2345b4)_0x323ed9[_0x5cc2bb(0x109)](_0x5cc2bb(0x14e));if(_0x323ed9[_0x5cc2bb(0x119)]>0x0){error_handler_1[_0x5cc2bb(0xfe)][_0x5cc2bb(0xf0)](_0x50913a,_0x5cc2bb(0x134)+_0x323ed9[_0x5cc2bb(0x133)](',\x20'),0x190);return;}const _0x48cc43=yield Display_1[_0x5cc2bb(0x112)]['findOne']({'macAddress':_0x468823});if(_0x48cc43){error_handler_1[_0x5cc2bb(0xfe)][_0x5cc2bb(0xf0)](_0x50913a,_0x5cc2bb(0x138),0x190);return;}const _0x1a5842=new Display_1['Display']({'name':_0x2345b4,'macAddress':_0x468823,'ownerId':_0x3b51b3,'description':_0x240618,'isLandscape':_0x11b447,'producer':_0x2645ba,'category':_0x2e3aa4,'dimension':_0x512b4b});yield _0x1a5842[_0x5cc2bb(0x14c)](),error_handler_1[_0x5cc2bb(0xfe)][_0x5cc2bb(0xff)](_0x50913a,_0x1a5842,_0x5cc2bb(0x153));}catch(_0x40f3bd){console['error'](_0x5cc2bb(0xee),_0x40f3bd),error_handler_1[_0x5cc2bb(0xfe)][_0x5cc2bb(0x101)](_0x50913a,_0x40f3bd);}})),router['put']('/edit/:id',authorise_1[a10_0x535592(0xfc)],(_0x4f2860,_0x178eb4)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x12d3c7=a10_0x535592;try{const {id:_0x5c935f}=_0x4f2860[_0x12d3c7(0x132)],{userId:_0x157b76}=_0x4f2860,_0x2c035a=__rest(_0x4f2860[_0x12d3c7(0x116)],[]),_0x48fab6=yield Display_1[_0x12d3c7(0x112)][_0x12d3c7(0x13c)]({'_id':_0x5c935f,'ownerId':_0x157b76},_0x2c035a,{'new':!![],'runValidators':!![]});if(!_0x48fab6){error_handler_1[_0x12d3c7(0xfe)][_0x12d3c7(0xfb)](_0x178eb4);return;}error_handler_1[_0x12d3c7(0xfe)][_0x12d3c7(0xff)](_0x178eb4,_0x48fab6);}catch(_0x84411){error_handler_1['ResponseHandler'][_0x12d3c7(0x101)](_0x178eb4,_0x12d3c7(0x13d)+_0x84411);}})),router[a10_0x535592(0x140)](a10_0x535592(0x124),authorise_1['default'],(_0x8f346f,_0x48bd43)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3bd596=a10_0x535592;try{const {id:_0x287f68}=_0x8f346f[_0x3bd596(0x132)],_0xbe563b=_0x8f346f[_0x3bd596(0x12c)],_0x15e20f=yield Display_1[_0x3bd596(0x112)]['findOneAndDelete']({'_id':_0x287f68,'ownerID':_0xbe563b});if(!_0x15e20f){error_handler_1[_0x3bd596(0xfe)][_0x3bd596(0xfb)](_0x48bd43,'Product\x20not\x20found\x20or\x20unauthorized');return;}error_handler_1[_0x3bd596(0xfe)]['success'](_0x48bd43,_0x15e20f,'Product\x20deleted\x20successfully');}catch(_0x1a5e47){error_handler_1['ResponseHandler'][_0x3bd596(0x101)](_0x48bd43,'Internal\x20server\x20error\x20:\x20'+_0x1a5e47);}})),router[a10_0x535592(0x13b)]('/all/:ownerId',authorise_1[a10_0x535592(0xfc)],(_0x19b5ed,_0x4156c8)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x50c49f=a10_0x535592;try{const {ownerId:_0x5f4af0}=_0x19b5ed[_0x50c49f(0x132)],_0x82dcd1=yield Display_1[_0x50c49f(0x112)][_0x50c49f(0x141)]({'ownerId':_0x5f4af0});if(!_0x82dcd1[_0x50c49f(0x119)]){error_handler_1[_0x50c49f(0xfe)][_0x50c49f(0x106)](_0x4156c8,_0x50c49f(0x14a));return;}error_handler_1[_0x50c49f(0xfe)][_0x50c49f(0xff)](_0x4156c8,_0x82dcd1);}catch(_0x3e8612){error_handler_1[_0x50c49f(0xfe)][_0x50c49f(0x101)](_0x4156c8,_0x50c49f(0x136)+_0x3e8612);}})),router[a10_0x535592(0x13b)](a10_0x535592(0x152),(_0x55bd04,_0x160ac3)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3bd866=a10_0x535592;try{const {displayId:_0x4bc993}=_0x55bd04[_0x3bd866(0x132)],_0x1dbd28={'_id':_0x4bc993},_0x3bec15=yield Display_1[_0x3bd866(0x112)][_0x3bd866(0xef)](_0x1dbd28);if(!_0x3bec15){error_handler_1['ResponseHandler'][_0x3bd866(0x106)](_0x160ac3,'Product\x20not\x20found\x20for\x20the\x20given\x20company');return;}error_handler_1[_0x3bd866(0xfe)][_0x3bd866(0xff)](_0x160ac3,_0x3bec15,_0x3bd866(0x122));}catch(_0x54f88d){console[_0x3bd866(0xf0)](_0x3bd866(0xf9),_0x54f88d),error_handler_1[_0x3bd866(0xfe)][_0x3bd866(0x101)](_0x160ac3,_0x3bd866(0x136)+_0x54f88d);}})),router[a10_0x535592(0x13b)](a10_0x535592(0x127),(_0x17e68b,_0x37b250)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x40c746=a10_0x535592;try{const {autoQR:_0x42f9ad}=_0x17e68b[_0x40c746(0x132)],_0x71c4d4={'autoQR':_0x42f9ad},_0x12f93e=yield Display_1[_0x40c746(0x112)]['findOne'](_0x71c4d4);if(!_0x12f93e){error_handler_1['ResponseHandler'][_0x40c746(0x106)](_0x37b250,_0x40c746(0xf2));return;}error_handler_1[_0x40c746(0xfe)][_0x40c746(0xff)](_0x37b250,_0x12f93e,'Display\x20retrieved\x20successfully');}catch(_0x26aa33){console[_0x40c746(0xf0)](_0x40c746(0x107),_0x26aa33),error_handler_1[_0x40c746(0xfe)]['internalServerError'](_0x37b250,_0x40c746(0x136)+_0x26aa33);}})),router[a10_0x535592(0x139)](a10_0x535592(0x128),authorise_2[a10_0x535592(0xfc)],upload[a10_0x535592(0x105)](a10_0x535592(0x10d),0x5),(_0xd7f9c,_0x434b3b)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3886af=a10_0x535592;try{const {displayId:_0x198571}=_0xd7f9c[_0x3886af(0x132)],_0x2f8e71=_0xd7f9c[_0x3886af(0x12c)];if(!_0xd7f9c[_0x3886af(0x146)]||!(_0xd7f9c[_0x3886af(0x146)]instanceof Array)){error_handler_1[_0x3886af(0xfe)]['notFound'](_0x434b3b,_0x3886af(0x147));return;}const _0x807620=yield Display_1['Display'][_0x3886af(0xef)]({'_id':_0x198571,'ownerID':_0x2f8e71});if(!_0x807620){error_handler_1['ResponseHandler'][_0x3886af(0xfb)](_0x434b3b,'Product\x20not\x20found\x20or\x20unauthorized');return;}const _0x57e9d5=_0xd7f9c[_0x3886af(0x146)]['map'](_0x118c4a=>_0x118c4a[_0x3886af(0x11c)]);_0x807620[_0x3886af(0x12e)]=[..._0x807620['imageIds']||[],..._0x57e9d5],yield _0x807620[_0x3886af(0x14c)](),error_handler_1['ResponseHandler'][_0x3886af(0xff)](_0x434b3b,_0x807620,'Images\x20uploaded\x20successfully');}catch(_0x543499){console[_0x3886af(0xf0)]('Image\x20Upload\x20Error:',_0x543499),error_handler_1[_0x3886af(0xfe)][_0x3886af(0x101)](_0x434b3b,_0x3886af(0x136)+_0x543499);}})),router[a10_0x535592(0x140)](a10_0x535592(0x142),authorise_2[a10_0x535592(0xfc)],(_0x16b9ca,_0x4749b1)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2ac17e=a10_0x535592;try{const {displayId:_0x707188,filename:_0x2e7514}=_0x16b9ca[_0x2ac17e(0x132)],_0x3b1578=_0x16b9ca['userId'],_0x40efbd=yield Display_1[_0x2ac17e(0x112)][_0x2ac17e(0xef)]({'_id':_0x707188,'ownerId':_0x3b1578});if(!_0x40efbd){error_handler_1[_0x2ac17e(0xfe)]['notFound'](_0x4749b1,_0x2ac17e(0x100));return;}if(!_0x40efbd[_0x2ac17e(0x12e)]||!_0x40efbd[_0x2ac17e(0x12e)][_0x2ac17e(0x104)](_0x2e7514)){error_handler_1[_0x2ac17e(0xfe)][_0x2ac17e(0x106)](_0x4749b1,_0x2ac17e(0x13e));return;}const _0x3f973d=path_1[_0x2ac17e(0xfc)][_0x2ac17e(0x133)](__dirname,_0x2ac17e(0xfd),storageDir,_0x2e7514);fs_1['default'][_0x2ac17e(0x111)](_0x3f973d,_0x225605=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x3bbcf9=_0x2ac17e;if(_0x225605){console['error']('File\x20Deletion\x20Error:',_0x225605),error_handler_1['ResponseHandler']['error'](_0x4749b1,_0x3bbcf9(0x12f)+_0x225605[_0x3bbcf9(0x11a)],0x19a);return;}_0x40efbd[_0x3bbcf9(0x12e)]=(_0x40efbd[_0x3bbcf9(0x12e)]||[])[_0x3bbcf9(0xf4)](_0x2e53f4=>_0x2e53f4!==_0x2e7514),yield _0x40efbd['save'](),error_handler_1[_0x3bbcf9(0xfe)][_0x3bbcf9(0xff)](_0x4749b1,_0x40efbd,_0x3bbcf9(0x13a));}));}catch(_0x5af8e0){console['error'](_0x2ac17e(0x14f),_0x5af8e0),error_handler_1['ResponseHandler']['internalServerError'](_0x4749b1,_0x2ac17e(0x13d)+_0x5af8e0);}})),router[a10_0x535592(0x13b)](a10_0x535592(0x128),(_0x3d93f4,_0x33a45f)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x4e6edd=a10_0x535592;try{const {displayId:_0xc673f1}=_0x3d93f4[_0x4e6edd(0x132)],_0x5b0130=_0x3d93f4,_0x4aacb4=yield Display_1[_0x4e6edd(0x112)]['findOne']({'_id':_0xc673f1,'ownerID':_0x5b0130});if(!_0x4aacb4){error_handler_1[_0x4e6edd(0xfe)][_0x4e6edd(0xfb)](_0x33a45f);return;}const _0x365ad7=_0x4aacb4[_0x4e6edd(0x12e)]||[],_0x239b20=_0x365ad7['map'](_0xebae4=>{const _0x1c6b33=_0x4e6edd;return _0x3d93f4['protocol']+_0x1c6b33(0x10c)+_0x3d93f4[_0x1c6b33(0x13b)]('host')+'/storage_regal/'+_0xebae4;});error_handler_1[_0x4e6edd(0xfe)]['success'](_0x33a45f,_0x239b20);}catch(_0x5adfae){console[_0x4e6edd(0xf0)](_0x4e6edd(0x145),_0x5adfae),error_handler_1[_0x4e6edd(0xfe)][_0x4e6edd(0x101)](_0x33a45f,_0x4e6edd(0x13d)+_0x5adfae);}})),router['get']('/image/:imageName',(_0x2d57df,_0x5df79d)=>__awaiter(void 0x0,void 0x0,void 0x0,function*(){const _0x2773e3=a10_0x535592;try{const {imageName:_0x3ba184}=_0x2d57df[_0x2773e3(0x132)],_0x4ef4b6=path_1['default'][_0x2773e3(0x133)](__dirname,_0x2773e3(0x120),storageDir,_0x3ba184);console['log'](_0x2773e3(0x150)+_0x4ef4b6);if(!fs_1[_0x2773e3(0xfc)][_0x2773e3(0x117)](_0x4ef4b6)){error_handler_1[_0x2773e3(0xfe)]['notFound'](_0x5df79d,_0x2773e3(0x113));return;}_0x5df79d[_0x2773e3(0xf3)](_0x4ef4b6);}catch(_0x3a6593){console[_0x2773e3(0xf0)](_0x2773e3(0x10b),_0x3a6593),error_handler_1[_0x2773e3(0xfe)]['internalServerError'](_0x5df79d,_0x2773e3(0x136)+_0x3a6593);}})),exports[a10_0x535592(0xfc)]=router;